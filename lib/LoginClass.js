import fetch from"node-fetch";import cookie from"cookie";import md5 from"md5";export default class Login{async login(a){if(a)this.atKey=a.atKey,this.sessionToken=a.sessionToken;else{const a=await fetch("https://asurso.ru/webapi/auth/getdata",{method:"POST"}),b=cookie.parse(a.headers.get("set-cookie")).NSSESSIONID,c=await a.json(),d=md5(c.salt+md5(this.loginDetails.password)),e={LoginType:1,cid:this.loginDetails.countryID,sid:this.loginDetails.regionID,pid:this.loginDetails.regionAreaID,cn:this.loginDetails.cityID,sft:this.loginDetails.schoolTypeID,scid:this.loginDetails.schoolID,UN:this.loginDetails.login,PW:d.substring(0,9),lt:c.lt,pw2:d,ver:c.ver},f=await fetch("https://asurso.ru/webapi/login",{method:"POST",body:new URLSearchParams(e),headers:{Cookie:cookie.serialize("NSSESSIONID",b),"X-Requested-With":"XMLHttpRequest"},referrer:"https://asurso.ru/about.html"}),g=await f.json();this.atKey=g.at,this.sessionToken=cookie.parse(f.headers.get("set-cookie")).ESRNSec}return this.studentId=await this.getStudentId(),{atKey:this.atKey,sessionToken:this.sessionToken}}async getStudentId(){const a=await this.fetch("https://asurso.ru/webapi/student/diary/init"),b=a.students[0].studentId;return b}}